{"version":3,"file":"index-D5RT-SAp.js","sources":["../../src/components/events/events-line-chart/events-line-chart.tsx","../../src/components/events/events-line-chart/interactive-events-chart.tsx","../../src/components/events/events-resource-filter/events-resource-filter.tsx","../../src/components/events/events-timeline/events-timeline.tsx","../../src/components/events/events-type-filter/events-type-filter.tsx","../../src/components/events/events-page/use-events-pagination.ts","../../src/components/events/events-page/events-page.tsx","../../src/routes/events/index.tsx?tsr-split=component"],"sourcesContent":["import { format } from \"date-fns\";\nimport { forwardRef, useImperativeHandle, useMemo, useRef } from \"react\";\nimport { Area, AreaChart, XAxis, YAxis } from \"recharts\";\nimport type { EventsCount } from \"@/api/events\";\nimport { ChartContainer, ChartTooltip } from \"@/components/ui/chart\";\nimport { cn } from \"@/utils\";\n\ntype ChartDataPoint = {\n\ttime: number;\n\tcount: number;\n\tlabel: string;\n};\n\ntype EventsTooltipProps = {\n\tactive?: boolean;\n\tpayload?: Array<{ payload?: ChartDataPoint }>;\n};\n\nconst EventsTooltipContent = ({ active, payload }: EventsTooltipProps) => {\n\tif (!active || !payload || !payload.length) return null;\n\n\tconst firstPayloadItem = payload[0];\n\tconst point = firstPayloadItem?.payload;\n\n\tif (\n\t\t!point ||\n\t\ttypeof point.time !== \"number\" ||\n\t\ttypeof point.count !== \"number\"\n\t) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"bg-popover border rounded-lg p-2 shadow-md\">\n\t\t\t<div className=\"text-sm font-medium\">{point.count} events</div>\n\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t{format(new Date(point.time), \"PPp\")}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport type EventsLineChartProps = {\n\tdata: EventsCount[];\n\tclassName?: string;\n\t/** Whether to show the X-axis with time labels (default: true) */\n\tshowAxis?: boolean;\n\t/** Date range start for chart display */\n\tstartDate?: Date;\n\t/** Date range end for chart display */\n\tendDate?: Date;\n\t/** Called when mouse hovers over chart with timestamp */\n\tonCursorChange?: (timestamp: Date | null) => void;\n};\n\nexport type EventsLineChartRef = {\n\tclearSelection: () => void;\n};\n\nconst chartConfig = {\n\tcount: {\n\t\tlabel: \"Events\",\n\t\tcolor: \"hsl(262.1 83.3% 57.8%)\",\n\t},\n};\n\nexport const EventsLineChart = forwardRef<\n\tEventsLineChartRef,\n\tEventsLineChartProps\n>(function EventsLineChart(\n\t{ data, className, showAxis = true, startDate, endDate, onCursorChange },\n\tref,\n) {\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\n\tuseImperativeHandle(ref, () => ({\n\t\tclearSelection: () => {\n\t\t\t// Selection clearing logic handled by parent\n\t\t},\n\t}));\n\n\tconst chartData = useMemo(() => {\n\t\tconst points = data.map((item) => ({\n\t\t\ttime: new Date(item.start_time).getTime(),\n\t\t\tcount: item.count,\n\t\t\tlabel: item.label,\n\t\t}));\n\n\t\t// Ensure we have boundary points at startDate and endDate so the line\n\t\t// extends across the full chart width (matching Vue implementation)\n\t\tif (startDate && endDate) {\n\t\t\tconst startTime = startDate.getTime();\n\t\t\tconst endTime = endDate.getTime();\n\n\t\t\t// Add start boundary point if not present\n\t\t\tif (points.length === 0 || points[0].time > startTime) {\n\t\t\t\tpoints.unshift({ time: startTime, count: 0, label: \"\" });\n\t\t\t}\n\n\t\t\t// Add end boundary point if not present\n\t\t\tif (points.length === 0 || points[points.length - 1].time < endTime) {\n\t\t\t\tpoints.push({ time: endTime, count: 0, label: \"\" });\n\t\t\t}\n\t\t}\n\n\t\treturn points;\n\t}, [data, startDate, endDate]);\n\n\tconst handleMouseMove = (state: { activeLabel?: string | number }) => {\n\t\tif (state.activeLabel !== undefined && onCursorChange) {\n\t\t\tconst timestamp =\n\t\t\t\ttypeof state.activeLabel === \"number\"\n\t\t\t\t\t? state.activeLabel\n\t\t\t\t\t: Number(state.activeLabel);\n\t\t\tif (!Number.isNaN(timestamp)) {\n\t\t\t\tonCursorChange(new Date(timestamp));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst handleMouseLeave = () => {\n\t\tonCursorChange?.(null);\n\t};\n\n\treturn (\n\t\t<div ref={containerRef} className={cn(\"relative\", className)}>\n\t\t\t<ChartContainer\n\t\t\t\tconfig={chartConfig}\n\t\t\t\tclassName=\"h-full w-[calc(100%+3rem)] -mx-6\"\n\t\t\t>\n\t\t\t\t<AreaChart\n\t\t\t\t\tdata={chartData}\n\t\t\t\t\tmargin={{ top: 0, right: 0, bottom: 0, left: 0 }}\n\t\t\t\t\tonMouseMove={handleMouseMove}\n\t\t\t\t\tonMouseLeave={handleMouseLeave}\n\t\t\t\t>\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<linearGradient id=\"eventsGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n\t\t\t\t\t\t\t<stop\n\t\t\t\t\t\t\t\toffset=\"0%\"\n\t\t\t\t\t\t\t\tstopColor=\"var(--color-count)\"\n\t\t\t\t\t\t\t\tstopOpacity={0.3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<stop\n\t\t\t\t\t\t\t\toffset=\"100%\"\n\t\t\t\t\t\t\t\tstopColor=\"var(--color-count)\"\n\t\t\t\t\t\t\t\tstopOpacity={0}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t</defs>\n\t\t\t\t\t<XAxis\n\t\t\t\t\t\tdataKey=\"time\"\n\t\t\t\t\t\ttickFormatter={(value: number) => format(new Date(value), \"HH:mm\")}\n\t\t\t\t\t\ttick={{ fontSize: 12 }}\n\t\t\t\t\t\taxisLine={false}\n\t\t\t\t\t\ttickLine={false}\n\t\t\t\t\t\tdomain={[\"dataMin\", \"dataMax\"]}\n\t\t\t\t\t\thide={!showAxis}\n\t\t\t\t\t/>\n\t\t\t\t\t<YAxis hide domain={[0, (max: number) => Math.max(1, max)]} />\n\t\t\t\t\t<ChartTooltip content={<EventsTooltipContent />} />\n\t\t\t\t\t<Area\n\t\t\t\t\t\ttype=\"monotone\"\n\t\t\t\t\t\tdataKey=\"count\"\n\t\t\t\t\t\tstroke=\"var(--color-count)\"\n\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\tfill=\"url(#eventsGradient)\"\n\t\t\t\t\t\tdot={false}\n\t\t\t\t\t\tactiveDot={false}\n\t\t\t\t\t\tisAnimationActive={false}\n\t\t\t\t\t/>\n\t\t\t\t</AreaChart>\n\t\t\t</ChartContainer>\n\t\t</div>\n\t);\n});\n","import type { EventsCount } from \"@/api/events\";\nimport { cn } from \"@/utils\";\nimport { EventsLineChart } from \"./events-line-chart\";\n\nexport type InteractiveEventsChartProps = {\n\tdata: EventsCount[];\n\tclassName?: string;\n\tstartDate: Date;\n\tendDate: Date;\n};\n\n/**\n * Interactive wrapper around EventsLineChart.\n */\nexport function InteractiveEventsChart({\n\tdata,\n\tclassName,\n\tstartDate,\n\tendDate,\n}: InteractiveEventsChartProps) {\n\treturn (\n\t\t<div className={cn(\"relative\", className)}>\n\t\t\t<EventsLineChart\n\t\t\t\tdata={data}\n\t\t\t\tclassName=\"h-full w-full\"\n\t\t\t\tshowAxis={false}\n\t\t\t\tstartDate={startDate}\n\t\t\t\tendDate={endDate}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n","import { Suspense, useDeferredValue, useMemo, useState } from \"react\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport {\n\ttype ResourceOption,\n\tuseResourceOptions,\n} from \"./use-resource-options\";\n\nexport type EventsResourceFilterProps = {\n\tselectedResourceIds: string[];\n\tonResourceIdsChange: (resourceIds: string[]) => void;\n};\n\nconst RESOURCE_TYPE_DISPLAY_NAMES: Record<ResourceOption[\"type\"], string> = {\n\tautomation: \"Automation\",\n\tblock: \"Block\",\n\tdeployment: \"Deployment\",\n\tflow: \"Flow\",\n\t\"work-pool\": \"Work Pool\",\n\t\"work-queue\": \"Work Queue\",\n};\n\nexport function EventsResourceFilter(props: EventsResourceFilterProps) {\n\treturn (\n\t\t<Suspense>\n\t\t\t<EventsResourceFilterImplementation {...props} />\n\t\t</Suspense>\n\t);\n}\n\nfunction EventsResourceFilterImplementation({\n\tselectedResourceIds,\n\tonResourceIdsChange,\n}: EventsResourceFilterProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst { resourceOptions } = useResourceOptions();\n\n\tconst filteredOptions = useMemo(() => {\n\t\tif (!deferredSearch) {\n\t\t\treturn resourceOptions;\n\t\t}\n\t\treturn resourceOptions.filter((option) =>\n\t\t\toption.name.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t);\n\t}, [resourceOptions, deferredSearch]);\n\n\tconst groupedOptions = useMemo(() => {\n\t\tconst groups: Record<ResourceOption[\"type\"], ResourceOption[]> = {\n\t\t\tautomation: [],\n\t\t\tblock: [],\n\t\t\tdeployment: [],\n\t\t\tflow: [],\n\t\t\t\"work-pool\": [],\n\t\t\t\"work-queue\": [],\n\t\t};\n\n\t\tfor (const option of filteredOptions) {\n\t\t\tgroups[option.type].push(option);\n\t\t}\n\n\t\treturn groups;\n\t}, [filteredOptions]);\n\n\tconst handleToggleResource = (resourceId: string) => {\n\t\tconst isSelected = selectedResourceIds.includes(resourceId);\n\t\tif (isSelected) {\n\t\t\tonResourceIdsChange(\n\t\t\t\tselectedResourceIds.filter((id) => id !== resourceId),\n\t\t\t);\n\t\t} else {\n\t\t\tonResourceIdsChange([...selectedResourceIds, resourceId]);\n\t\t}\n\t\tsetSearch(\"\");\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger\n\t\t\t\taria-label=\"Filter by resource\"\n\t\t\t\tselected={selectedResourceIds.length > 0}\n\t\t\t>\n\t\t\t\t{selectedResourceIds.length > 0\n\t\t\t\t\t? `${selectedResourceIds.length} resource${selectedResourceIds.length === 1 ? \"\" : \"s\"} selected`\n\t\t\t\t\t: \"All resources\"}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search resources...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandEmtpy>No resources found</ComboboxCommandEmtpy>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t{(\n\t\t\t\t\t\tObject.entries(groupedOptions) as [\n\t\t\t\t\t\t\tResourceOption[\"type\"],\n\t\t\t\t\t\t\tResourceOption[],\n\t\t\t\t\t\t][]\n\t\t\t\t\t).map(([type, options]) =>\n\t\t\t\t\t\toptions.length > 0 ? (\n\t\t\t\t\t\t\t<ComboboxCommandGroup\n\t\t\t\t\t\t\t\tkey={type}\n\t\t\t\t\t\t\t\theading={RESOURCE_TYPE_DISPLAY_NAMES[type]}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{options.map((option) => (\n\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\tkey={option.resourceId}\n\t\t\t\t\t\t\t\t\t\tvalue={option.resourceId}\n\t\t\t\t\t\t\t\t\t\tselected={selectedResourceIds.includes(option.resourceId)}\n\t\t\t\t\t\t\t\t\t\tonSelect={handleToggleResource}\n\t\t\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{option.name}\n\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t\t) : null,\n\t\t\t\t\t)}\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { Link } from \"@tanstack/react-router\";\nimport { format } from \"date-fns\";\nimport { ChevronDown } from \"lucide-react\";\nimport { useState } from \"react\";\nimport type { components } from \"@/api/prefect\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport {\n\tCollapsible,\n\tCollapsibleContent,\n\tCollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { Icon } from \"@/components/ui/icons\";\nimport { JsonView } from \"@/components/ui/json-view\";\nimport { cn } from \"@/utils\";\nimport {\n\tEventResourceDisplay,\n\tEventResourceLink,\n} from \"../event-resource-display\";\nimport {\n\tparseResourceType,\n\tRESOURCE_ICONS,\n\tRESOURCE_TYPE_LABELS,\n} from \"../event-resource-display/resource-types\";\nimport { formatEventLabel } from \"./utilities\";\n\ntype Event = components[\"schemas\"][\"ReceivedEvent\"];\n\ntype EventsTimelineProps = {\n\tevents: Event[];\n\tclassName?: string;\n};\n\ntype EventTimelineItemProps = {\n\tevent: Event;\n\tisLast: boolean;\n};\n\nfunction EventTimestamp({ occurred }: { occurred: string }) {\n\tconst date = new Date(occurred);\n\tconst formattedTime = format(date, \"h:mm:ss a\");\n\tconst formattedDate = format(date, \"MMM do, yyyy\");\n\n\treturn (\n\t\t<div className=\"flex flex-col text-right text-sm w-24 shrink-0\">\n\t\t\t<span>{formattedTime}</span>\n\t\t\t<span className=\"text-xs text-muted-foreground\">{formattedDate}</span>\n\t\t</div>\n\t);\n}\n\nfunction TimelinePoint({ event, isLast }: { event: Event; isLast: boolean }) {\n\tconst resourceId = event.resource[\"prefect.resource.id\"] || \"\";\n\tconst resourceType = parseResourceType(resourceId);\n\tconst iconId = RESOURCE_ICONS[resourceType];\n\n\treturn (\n\t\t<div className=\"relative flex items-start justify-center w-10 h-full\">\n\t\t\t{/* Vertical line - extends from top to bottom, hidden for last item below the icon */}\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"absolute left-1/2 w-px -translate-x-1/2 bg-border\",\n\t\t\t\t\tisLast ? \"top-0 h-5\" : \"top-0 bottom-0\",\n\t\t\t\t)}\n\t\t\t\tstyle={{ top: \"-1rem\", bottom: isLast ? \"auto\" : \"-1rem\" }}\n\t\t\t/>\n\t\t\t{/* Icon circle */}\n\t\t\t<div className=\"relative flex items-center justify-center w-10 h-10 rounded-full bg-background border border-border\">\n\t\t\t\t<Icon id={iconId} className=\"h-5 w-5 text-muted-foreground\" />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Formats a Date object as YYYY-MM-DD for use in route parameters.\n */\nfunction formatRouteDate(date: Date): string {\n\tconst year = date.getFullYear();\n\tconst month = String(date.getMonth() + 1).padStart(2, \"0\");\n\tconst day = String(date.getDate()).padStart(2, \"0\");\n\treturn `${year}-${month}-${day}`;\n}\n\nfunction EventNameWithPrefixes({\n\teventId,\n\teventName,\n\toccurred,\n}: {\n\teventId: string;\n\teventName: string;\n\toccurred: string;\n}) {\n\tconst label = formatEventLabel(eventName);\n\tconst eventDate = formatRouteDate(new Date(occurred));\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-0.5\">\n\t\t\t<Link\n\t\t\t\tto=\"/events/event/$eventDate/$eventId\"\n\t\t\t\tparams={{ eventDate, eventId }}\n\t\t\t\tclassName=\"text-left font-medium hover:underline\"\n\t\t\t>\n\t\t\t\t{label}\n\t\t\t</Link>\n\t\t\t<span className=\"text-xs text-muted-foreground font-mono\">\n\t\t\t\t{eventName}\n\t\t\t</span>\n\t\t</div>\n\t);\n}\n\nfunction getResourceRole(resource: Record<string, string>): string | undefined {\n\treturn resource[\"prefect.resource.role\"];\n}\n\nfunction getResourceId(resource: Record<string, string>): string {\n\treturn resource[\"prefect.resource.id\"] || \"\";\n}\n\nfunction getResourceName(resource: Record<string, string>): string | null {\n\treturn (\n\t\tresource[\"prefect.resource.name\"] ||\n\t\tresource[\"prefect.name\"] ||\n\t\tresource[\"prefect-cloud.name\"] ||\n\t\tnull\n\t);\n}\n\nfunction EventRelatedResources({\n\trelated,\n}: {\n\trelated: components[\"schemas\"][\"RelatedResource\"][];\n}) {\n\tif (!related || related.length === 0) {\n\t\treturn null;\n\t}\n\n\t// Separate tags from other resources\n\tconst tags: components[\"schemas\"][\"RelatedResource\"][] = [];\n\tconst resources: components[\"schemas\"][\"RelatedResource\"][] = [];\n\n\tfor (const resource of related) {\n\t\tconst role = getResourceRole(resource);\n\t\tif (role === \"tag\") {\n\t\t\ttags.push(resource);\n\t\t} else {\n\t\t\tresources.push(resource);\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t<span className=\"text-sm font-medium\">Related Resources</span>\n\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t{resources.map((resource) => {\n\t\t\t\t\tconst resourceId = getResourceId(resource);\n\t\t\t\t\tconst resourceName = getResourceName(resource);\n\t\t\t\t\tconst displayText = resourceName || resourceId;\n\t\t\t\t\tconst resourceType = parseResourceType(resourceId);\n\t\t\t\t\tconst typeLabel = RESOURCE_TYPE_LABELS[resourceType];\n\t\t\t\t\tconst iconId = RESOURCE_ICONS[resourceType];\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<EventResourceLink\n\t\t\t\t\t\t\tkey={resourceId}\n\t\t\t\t\t\t\tresource={resource}\n\t\t\t\t\t\t\trelatedResources={related}\n\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground hover:underline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{typeLabel && <span>{typeLabel}</span>}\n\t\t\t\t\t\t\t<Icon id={iconId} className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t<span>{displayText}</span>\n\t\t\t\t\t\t</EventResourceLink>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t\t{tags.length > 0 && (\n\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t{tags.map((tag) => {\n\t\t\t\t\t\t\tconst tagId = getResourceId(tag);\n\t\t\t\t\t\t\tconst tagName = getResourceName(tag) || tagId.split(\".\").pop();\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Badge key={tagId} variant=\"secondary\">\n\t\t\t\t\t\t\t\t\t{tagName}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction EventTimelineItem({ event, isLast }: EventTimelineItemProps) {\n\tconst [isOpen, setIsOpen] = useState(false);\n\n\treturn (\n\t\t<div className=\"grid grid-cols-[6rem_2.5rem_1fr] gap-4 items-start py-4\">\n\t\t\t{/* Date column */}\n\t\t\t<EventTimestamp occurred={event.occurred} />\n\n\t\t\t{/* Point column with icon and vertical line */}\n\t\t\t<TimelinePoint event={event} isLast={isLast} />\n\n\t\t\t{/* Content column */}\n\t\t\t<Collapsible open={isOpen} onOpenChange={setIsOpen}>\n\t\t\t\t<Card className=\"py-4\">\n\t\t\t\t\t<CardHeader className=\"py-0\">\n\t\t\t\t\t\t<div className=\"flex flex-col gap-3\">\n\t\t\t\t\t\t\t<EventNameWithPrefixes\n\t\t\t\t\t\t\t\teventId={event.id}\n\t\t\t\t\t\t\t\teventName={event.event}\n\t\t\t\t\t\t\t\toccurred={event.occurred}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<EventResourceDisplay event={event} />\n\t\t\t\t\t\t\t{event.related && event.related.length > 0 && (\n\t\t\t\t\t\t\t\t<EventRelatedResources related={event.related} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<div className=\"px-6 pt-2\">\n\t\t\t\t\t\t<CollapsibleTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclassName=\"w-full justify-center gap-2 text-muted-foreground\"\n\t\t\t\t\t\t\t\taria-label={\n\t\t\t\t\t\t\t\t\tisOpen ? \"Collapse event details\" : \"Expand event details\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ChevronDown\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-transform duration-200\",\n\t\t\t\t\t\t\t\t\t\tisOpen && \"rotate-180\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t{isOpen ? \"Hide raw event\" : \"Show raw event\"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</CollapsibleTrigger>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CollapsibleContent>\n\t\t\t\t\t\t<CardContent className=\"pt-4\">\n\t\t\t\t\t\t\t<JsonView\n\t\t\t\t\t\t\t\tvalue={JSON.stringify(event, null, 2)}\n\t\t\t\t\t\t\t\tclassName=\"max-h-96 overflow-auto\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</CollapsibleContent>\n\t\t\t\t</Card>\n\t\t\t</Collapsible>\n\t\t</div>\n\t);\n}\n\nexport function EventsTimeline({ events, className }: EventsTimelineProps) {\n\tif (!events || events.length === 0) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<ol className={cn(\"list-none p-0 m-0\", className)}>\n\t\t\t{events.map((event, index) => (\n\t\t\t\t<li key={event.id}>\n\t\t\t\t\t<EventTimelineItem\n\t\t\t\t\t\tevent={event}\n\t\t\t\t\t\tisLast={index === events.length - 1}\n\t\t\t\t\t/>\n\t\t\t\t</li>\n\t\t\t))}\n\t\t</ol>\n\t);\n}\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { buildEventsCountQuery, type EventsCountFilter } from \"@/api/events\";\nimport { getEventPrefixes } from \"@/components/events/events-timeline/utilities\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport { Typography } from \"@/components/ui/typography\";\n\nconst MAX_EVENT_TYPES_DISPLAYED = 2;\n\nexport type EventsTypeFilterProps = {\n\tfilter: EventsCountFilter;\n\tselectedEventTypes: string[];\n\tonEventTypesChange: (eventTypes: string[]) => void;\n};\n\nexport function EventsTypeFilter({\n\tfilter,\n\tselectedEventTypes,\n\tonEventTypesChange,\n}: EventsTypeFilterProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst { data: eventCounts = [] } = useQuery(\n\t\tbuildEventsCountQuery(\"event\", filter),\n\t);\n\n\tconst eventTypeOptions = useMemo(() => {\n\t\tconst prefixSet = new Set<string>();\n\n\t\tfor (const eventCount of eventCounts) {\n\t\t\tconst prefixes = getEventPrefixes(eventCount.value);\n\t\t\tfor (const prefix of prefixes) {\n\t\t\t\tprefixSet.add(prefix);\n\t\t\t}\n\t\t}\n\n\t\treturn Array.from(prefixSet).sort();\n\t}, [eventCounts]);\n\n\tconst filteredOptions = useMemo(() => {\n\t\tif (!deferredSearch) {\n\t\t\treturn eventTypeOptions;\n\t\t}\n\t\treturn eventTypeOptions.filter((option) =>\n\t\t\toption.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t);\n\t}, [eventTypeOptions, deferredSearch]);\n\n\tconst handleSelectEventType = (eventType: string) => {\n\t\tconst isSelected = selectedEventTypes.includes(eventType);\n\t\tif (isSelected) {\n\t\t\tonEventTypesChange(\n\t\t\t\tselectedEventTypes.filter((type) => type !== eventType),\n\t\t\t);\n\t\t} else {\n\t\t\tonEventTypesChange([...selectedEventTypes, eventType]);\n\t\t}\n\t};\n\n\tconst handleClearAll = () => {\n\t\tonEventTypesChange([]);\n\t};\n\n\tconst renderSelectedEventTypes = () => {\n\t\tif (selectedEventTypes.length === 0) {\n\t\t\treturn \"All event types\";\n\t\t}\n\n\t\tconst visible = selectedEventTypes.slice(0, MAX_EVENT_TYPES_DISPLAYED);\n\t\tconst extraCount = selectedEventTypes.length - MAX_EVENT_TYPES_DISPLAYED;\n\n\t\treturn (\n\t\t\t<div className=\"flex flex-1 min-w-0 items-center gap-2\">\n\t\t\t\t<div className=\"flex flex-1 min-w-0 items-center gap-2 overflow-hidden\">\n\t\t\t\t\t<span className=\"truncate\">{visible.join(\", \")}</span>\n\t\t\t\t</div>\n\t\t\t\t{extraCount > 0 && (\n\t\t\t\t\t<Typography variant=\"bodySmall\" className=\"shrink-0\">\n\t\t\t\t\t\t+ {extraCount}\n\t\t\t\t\t</Typography>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger\n\t\t\t\taria-label=\"Filter by event type\"\n\t\t\t\tselected={selectedEventTypes.length === 0}\n\t\t\t>\n\t\t\t\t{renderSelectedEventTypes()}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search event types...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t<ComboboxCommandEmtpy>No event types found</ComboboxCommandEmtpy>\n\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\taria-label=\"All event types\"\n\t\t\t\t\t\t\tonSelect={handleClearAll}\n\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\tvalue=\"__all__\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Checkbox checked={selectedEventTypes.length === 0} />\n\t\t\t\t\t\t\tAll event types\n\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t{filteredOptions.map((eventType) => (\n\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\tkey={eventType}\n\t\t\t\t\t\t\t\taria-label={eventType}\n\t\t\t\t\t\t\t\tonSelect={() => handleSelectEventType(eventType)}\n\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\tvalue={eventType}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Checkbox checked={selectedEventTypes.includes(eventType)} />\n\t\t\t\t\t\t\t\t{eventType}\n\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useEffect, useRef, useState } from \"react\";\nimport {\n\tbuildEventsNextPageQuery,\n\tbuildFilterEventsQuery,\n\ttype Event,\n\ttype EventsFilter,\n} from \"@/api/events\";\n\nconst PAGE_SIZE = 50;\n\ntype UseEventsPaginationOptions = {\n\tfilter: EventsFilter;\n};\n\ntype UseEventsPaginationReturn = {\n\tevents: Event[];\n\tcurrentPage: number;\n\ttotalPages: number;\n\ttotal: number;\n\tisLoadingNextPage: boolean;\n\tgoToPage: (page: number) => void;\n\tgoToNextPage: () => void;\n\tgoToPreviousPage: () => void;\n};\n\n/**\n * Hook for cursor-based pagination of events using a token vault pattern.\n *\n * The backend uses cursor-based pagination where each page response includes\n * a `next_page` URL containing a token to fetch the next page. This hook\n * manages these tokens in a \"vault\" (a Map) to enable bidirectional navigation.\n *\n * Key features:\n * - `tokenVault[n]` contains the token to fetch page `n+1`\n * - Clears token vault when filter changes (detected via JSON.stringify comparison)\n * - Stores next page tokens from API responses as they're received\n * - Uses `useQuery` for both the first page and subsequent pages\n *\n * @param options - Configuration options\n * @param options.filter - The events filter to apply\n * @returns Pagination state and navigation functions\n *\n * @example\n * ```tsx\n * const {\n *   events,\n *   currentPage,\n *   totalPages,\n *   isLoadingNextPage,\n *   goToPage,\n *   goToNextPage,\n *   goToPreviousPage,\n * } = useEventsPagination({ filter: myFilter });\n * ```\n */\nexport function useEventsPagination({\n\tfilter,\n}: UseEventsPaginationOptions): UseEventsPaginationReturn {\n\tconst [currentPage, setCurrentPage] = useState(1);\n\tconst tokenVault = useRef<Map<number, string>>(new Map());\n\tconst previousFilterRef = useRef<string>(JSON.stringify(filter));\n\n\t// Reset pagination when filter changes\n\tuseEffect(() => {\n\t\tconst currentFilterString = JSON.stringify(filter);\n\t\tif (previousFilterRef.current !== currentFilterString) {\n\t\t\ttokenVault.current.clear();\n\t\t\tsetCurrentPage(1);\n\t\t\tpreviousFilterRef.current = currentFilterString;\n\t\t}\n\t}, [filter]);\n\n\t// First page query - always fetches the first page\n\tconst firstPageQuery = useQuery(buildFilterEventsQuery(filter));\n\n\t// Store the next_page token from first page response\n\tuseEffect(() => {\n\t\tif (firstPageQuery.data?.next_page) {\n\t\t\ttokenVault.current.set(1, firstPageQuery.data.next_page);\n\t\t}\n\t}, [firstPageQuery.data?.next_page]);\n\n\t// Get the token for the current page (if not page 1)\n\tconst currentPageToken =\n\t\tcurrentPage > 1 ? tokenVault.current.get(currentPage - 1) : null;\n\n\t// Subsequent page query - only enabled when we have a token and not on page 1\n\tconst nextPageQuery = useQuery({\n\t\t...buildEventsNextPageQuery(currentPageToken ?? \"\"),\n\t\tenabled: currentPage > 1 && !!currentPageToken,\n\t});\n\n\t// Store the next_page token from subsequent page responses\n\tuseEffect(() => {\n\t\tif (nextPageQuery.data?.next_page && currentPage > 1) {\n\t\t\ttokenVault.current.set(currentPage, nextPageQuery.data.next_page);\n\t\t}\n\t}, [nextPageQuery.data?.next_page, currentPage]);\n\n\t// Calculate total pages from the first page total count\n\tconst total = firstPageQuery.data?.total ?? 0;\n\tconst totalPages = Math.ceil(total / PAGE_SIZE);\n\n\t// Determine current events based on which page we're on\n\tconst events =\n\t\tcurrentPage === 1\n\t\t\t? (firstPageQuery.data?.events ?? [])\n\t\t\t: (nextPageQuery.data?.events ?? firstPageQuery.data?.events ?? []);\n\n\tconst isLoadingNextPage = currentPage > 1 && nextPageQuery.isLoading;\n\n\tconst goToPage = (page: number) => {\n\t\tif (page < 1 || page > totalPages) return;\n\t\tif (page > 1 && !tokenVault.current.has(page - 1)) {\n\t\t\treturn;\n\t\t}\n\t\tsetCurrentPage(page);\n\t};\n\n\tconst goToNextPage = () => {\n\t\tif (currentPage < totalPages && tokenVault.current.has(currentPage)) {\n\t\t\tsetCurrentPage(currentPage + 1);\n\t\t}\n\t};\n\n\tconst goToPreviousPage = () => {\n\t\tif (currentPage > 1) {\n\t\t\tsetCurrentPage(currentPage - 1);\n\t\t}\n\t};\n\n\treturn {\n\t\tevents,\n\t\tcurrentPage,\n\t\ttotalPages,\n\t\ttotal,\n\t\tisLoadingNextPage,\n\t\tgoToPage,\n\t\tgoToNextPage,\n\t\tgoToPreviousPage,\n\t};\n}\n","import { useQuery } from \"@tanstack/react-query\";\nimport { Suspense, useEffect, useState } from \"react\";\nimport { buildEventsHistoryQuery } from \"@/api/events\";\nimport {\n\tbuildEventsCountFilterFromSearch,\n\tbuildEventsFilterFromSearch,\n\ttype EventsSearchParams,\n\tgetDateRangeFromSearch,\n} from \"@/api/events/filters\";\nimport {\n\tBreadcrumb,\n\tBreadcrumbItem,\n\tBreadcrumbList,\n} from \"@/components/ui/breadcrumb\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport {\n\ttype DateRangeSelectValue,\n\tRichDateRangeSelector,\n} from \"@/components/ui/date-range-select\";\nimport {\n\tEmptyState,\n\tEmptyStateDescription,\n\tEmptyStateIcon,\n\tEmptyStateTitle,\n} from \"@/components/ui/empty-state\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tPagination,\n\tPaginationContent,\n\tPaginationItem,\n\tPaginationNextButton,\n\tPaginationPreviousButton,\n} from \"@/components/ui/pagination\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Typography } from \"@/components/ui/typography\";\nimport { cn } from \"@/utils\";\nimport { InteractiveEventsChart } from \"../events-line-chart\";\nimport { EventsResourceFilter } from \"../events-resource-filter\";\nimport { EventsTimeline } from \"../events-timeline\";\nimport { EventsTypeFilter } from \"../events-type-filter\";\nimport { useEventsPagination } from \"./use-events-pagination\";\n\nexport type EventsPageProps = {\n\tsearch: EventsSearchParams;\n\tonSearchChange: (search: Partial<EventsSearchParams>) => void;\n};\n\nexport function EventsPage({ search, onSearchChange }: EventsPageProps) {\n\t// Get the date range using the same logic as the route loader\n\t// This ensures query keys match and prevents infinite Suspense retries\n\tconst dateRange = getDateRangeFromSearch(search);\n\n\tconst eventsFilter = buildEventsFilterFromSearch(search);\n\tconst countFilter = buildEventsCountFilterFromSearch({\n\t\t...search,\n\t\trangeType: \"range\",\n\t\tstart: dateRange.from,\n\t\tend: dateRange.to,\n\t});\n\n\t// Create separate filter for type dropdown (without event filter)\n\t// This ensures all event types are shown regardless of current selection\n\tconst countFilterForTypeDropdown = buildEventsCountFilterFromSearch({\n\t\tresource: search.resource,\n\t\trangeType: \"range\",\n\t\tstart: dateRange.from,\n\t\tend: dateRange.to,\n\t});\n\n\t// Pagination\n\tconst {\n\t\tevents,\n\t\tcurrentPage,\n\t\ttotalPages,\n\t\tisLoadingNextPage,\n\t\tgoToNextPage,\n\t\tgoToPreviousPage,\n\t} = useEventsPagination({ filter: eventsFilter });\n\n\t// Chart histogram data\n\tconst { data: historyData } = useQuery(buildEventsHistoryQuery(countFilter));\n\n\t// Handlers - using correct property names that match EventsSearchParams\n\tconst handleResourceIdsChange = (resourceIds: string[]) => {\n\t\tonSearchChange({ resource: resourceIds });\n\t};\n\n\tconst handleEventTypesChange = (eventPrefixes: string[]) => {\n\t\tonSearchChange({ event: eventPrefixes });\n\t};\n\n\tconst handleDateRangeChange = (value: DateRangeSelectValue) => {\n\t\tif (value?.type === \"span\") {\n\t\t\tonSearchChange({ rangeType: \"span\", seconds: value.seconds });\n\t\t} else if (value?.type === \"range\") {\n\t\t\tonSearchChange({\n\t\t\t\trangeType: \"range\",\n\t\t\t\tstart: value.startDate.toISOString(),\n\t\t\t\tend: value.endDate.toISOString(),\n\t\t\t});\n\t\t}\n\t};\n\n\t// Sticky chart behavior\n\tconst [isChartSticky, setIsChartSticky] = useState(false);\n\n\tuseEffect(() => {\n\t\tconst handleScroll = () => {\n\t\t\t// Chart becomes sticky when scrolled past 100px\n\t\t\tsetIsChartSticky(window.scrollY > 100);\n\t\t};\n\n\t\twindow.addEventListener(\"scroll\", handleScroll);\n\t\treturn () => window.removeEventListener(\"scroll\", handleScroll);\n\t}, []);\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Breadcrumb>\n\t\t\t\t\t\t<BreadcrumbList>\n\t\t\t\t\t\t\t<BreadcrumbItem className=\"text-xl font-semibold\">\n\t\t\t\t\t\t\t\tEvent Feed\n\t\t\t\t\t\t\t</BreadcrumbItem>\n\t\t\t\t\t\t</BreadcrumbList>\n\t\t\t\t\t</Breadcrumb>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Filters */}\n\t\t\t<div className=\"grid grid-cols-1 gap-4 sm:grid-cols-[2fr_1fr]\">\n\t\t\t\t<div className=\"flex flex-col gap-1\">\n\t\t\t\t\t<Label>Resource</Label>\n\t\t\t\t\t<Suspense fallback={<Skeleton className=\"h-10 w-full\" />}>\n\t\t\t\t\t\t<EventsResourceFilter\n\t\t\t\t\t\t\tselectedResourceIds={search.resource ?? []}\n\t\t\t\t\t\t\tonResourceIdsChange={handleResourceIdsChange}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Suspense>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex flex-col gap-1\">\n\t\t\t\t\t<Label>Events</Label>\n\t\t\t\t\t<Suspense fallback={<Skeleton className=\"h-10 w-full\" />}>\n\t\t\t\t\t\t<EventsTypeFilter\n\t\t\t\t\t\t\tfilter={countFilterForTypeDropdown}\n\t\t\t\t\t\t\tselectedEventTypes={search.event ?? []}\n\t\t\t\t\t\t\tonEventTypesChange={handleEventTypesChange}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Suspense>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Chart - sticky when scrolling */}\n\t\t\t<Card\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"sticky top-0 z-10 transition-shadow\",\n\t\t\t\t\tisChartSticky && \"shadow-lg\",\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<CardContent className=\"pt-6\">\n\t\t\t\t\t<InteractiveEventsChart\n\t\t\t\t\t\tdata={historyData ?? []}\n\t\t\t\t\t\tclassName=\"h-32\"\n\t\t\t\t\t\tstartDate={new Date(dateRange.from)}\n\t\t\t\t\t\tendDate={new Date(dateRange.to)}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"flex justify-center pt-3\">\n\t\t\t\t\t\t<RichDateRangeSelector\n\t\t\t\t\t\t\tvalue={\n\t\t\t\t\t\t\t\tsearch.rangeType === \"range\" && search.start && search.end\n\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"range\",\n\t\t\t\t\t\t\t\t\t\t\tstartDate: new Date(search.start),\n\t\t\t\t\t\t\t\t\t\t\tendDate: new Date(search.end),\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t: { type: \"span\", seconds: search.seconds ?? -86400 }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonValueChange={handleDateRangeChange}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Events timeline or empty state */}\n\t\t\t{events.length === 0 ? (\n\t\t\t\t<EmptyState>\n\t\t\t\t\t<EmptyStateIcon id=\"Calendar\" />\n\t\t\t\t\t<EmptyStateTitle>No events found</EmptyStateTitle>\n\t\t\t\t\t<EmptyStateDescription>\n\t\t\t\t\t\tNo events match your current filters. Try adjusting your date range\n\t\t\t\t\t\tor filters.\n\t\t\t\t\t</EmptyStateDescription>\n\t\t\t\t</EmptyState>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<EventsTimeline events={events} />\n\n\t\t\t\t\t{/* Pagination */}\n\t\t\t\t\t{totalPages > 1 && (\n\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t\t\t<Pagination>\n\t\t\t\t\t\t\t\t<PaginationContent>\n\t\t\t\t\t\t\t\t\t<PaginationItem>\n\t\t\t\t\t\t\t\t\t\t<PaginationPreviousButton\n\t\t\t\t\t\t\t\t\t\t\tonClick={goToPreviousPage}\n\t\t\t\t\t\t\t\t\t\t\tdisabled={currentPage <= 1}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</PaginationItem>\n\t\t\t\t\t\t\t\t\t<PaginationItem>\n\t\t\t\t\t\t\t\t\t\t<Typography variant=\"bodySmall\" className=\"px-2\">\n\t\t\t\t\t\t\t\t\t\t\tPage {currentPage} of {totalPages}\n\t\t\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t\t\t</PaginationItem>\n\t\t\t\t\t\t\t\t\t<PaginationItem>\n\t\t\t\t\t\t\t\t\t\t<PaginationNextButton\n\t\t\t\t\t\t\t\t\t\t\tonClick={goToNextPage}\n\t\t\t\t\t\t\t\t\t\t\tdisabled={currentPage >= totalPages}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</PaginationItem>\n\t\t\t\t\t\t\t\t</PaginationContent>\n\t\t\t\t\t\t\t</Pagination>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{isLoadingNextPage && (\n\t\t\t\t\t\t<div className=\"flex justify-center py-4\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-8 w-32\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","import { createFileRoute } from \"@tanstack/react-router\";\nimport { zodValidator } from \"@tanstack/zod-adapter\";\nimport { Suspense } from \"react\";\nimport { z } from \"zod\";\nimport { buildEventsHistoryQuery, buildFilterEventsQuery } from \"@/api/events\";\nimport {\n\tbuildEventsCountFilterFromSearch,\n\tbuildEventsFilterFromSearch,\n\ttype EventsSearchParams,\n} from \"@/api/events/filters\";\nimport { EventsPage } from \"@/components/events/events-page\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\n/**\n * Schema for validating URL search parameters for the events page.\n * Uses existing parameter names (resource, event) for compatibility with API infrastructure.\n */\nconst searchParams = z.object({\n\tresource: z.array(z.string()).optional(),\n\tevent: z.array(z.string()).optional(),\n\trangeType: z.enum([\"span\", \"range\"]).optional().default(\"span\"),\n\tseconds: z.number().optional().default(-86400),\n\tstart: z.string().optional(),\n\tend: z.string().optional(),\n\torder: z.enum([\"ASC\", \"DESC\"]).optional(),\n});\n\n/**\n * Skeleton component shown while the events page is loading.\n * Displays placeholder elements for header, filters, chart, and timeline.\n */\nfunction EventsPageSkeleton() {\n\treturn (\n\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t{/* Header skeleton */}\n\t\t\t<Skeleton className=\"h-8 w-48\" />\n\t\t\t{/* Filters skeleton */}\n\t\t\t<div className=\"flex flex-wrap gap-4\">\n\t\t\t\t<Skeleton className=\"h-10 w-48\" />\n\t\t\t\t<Skeleton className=\"h-10 w-48\" />\n\t\t\t\t<Skeleton className=\"h-10 w-48\" />\n\t\t\t</div>\n\t\t\t{/* Chart area skeleton */}\n\t\t\t<Skeleton className=\"h-32 w-full\" />\n\t\t\t{/* Timeline area skeleton */}\n\t\t\t<Skeleton className=\"h-64 w-full\" />\n\t\t</div>\n\t);\n}\n\nexport const Route = createFileRoute(\"/events/\")({\n\tvalidateSearch: zodValidator(searchParams),\n\tloaderDeps: ({ search }) => search,\n\twrapInSuspense: true,\n\tpendingComponent: EventsPageSkeleton,\n\tloader: ({ deps: search, context: { queryClient } }) => {\n\t\tconst eventsFilter = buildEventsFilterFromSearch(search);\n\t\tconst countFilter = buildEventsCountFilterFromSearch(search);\n\n\t\t// Prefetch queries without blocking route loading\n\t\tvoid queryClient.prefetchQuery(buildFilterEventsQuery(eventsFilter));\n\t\tvoid queryClient.prefetchQuery(buildEventsHistoryQuery(countFilter));\n\t},\n\tcomponent: RouteComponent,\n});\n\nfunction RouteComponent() {\n\tconst search = Route.useSearch();\n\tconst navigate = Route.useNavigate();\n\n\tconst handleSearchChange = (updates: Partial<EventsSearchParams>) => {\n\t\tvoid navigate({\n\t\t\tto: \".\",\n\t\t\tsearch: (prev) => ({ ...prev, ...updates }),\n\t\t\treplace: true,\n\t\t});\n\t};\n\n\treturn (\n\t\t<Suspense fallback={<EventsPageSkeleton />}>\n\t\t\t<EventsPage search={search} onSearchChange={handleSearchChange} />\n\t\t</Suspense>\n\t);\n}\n"],"names":["EventsTooltipContent","active","payload","point","jsxs","jsx","format","chartConfig","EventsLineChart","forwardRef","data","className","showAxis","startDate","endDate","onCursorChange","ref","containerRef","useRef","useImperativeHandle","chartData","useMemo","points","item","startTime","endTime","handleMouseMove","state","timestamp","handleMouseLeave","cn","ChartContainer","AreaChart","XAxis","value","YAxis","max","ChartTooltip","Area","InteractiveEventsChart","RESOURCE_TYPE_DISPLAY_NAMES","EventsResourceFilter","props","Suspense","EventsResourceFilterImplementation","selectedResourceIds","onResourceIdsChange","search","setSearch","useState","deferredSearch","useDeferredValue","resourceOptions","useResourceOptions","filteredOptions","option","groupedOptions","groups","handleToggleResource","resourceId","isSelected","id","Combobox","ComboboxTrigger","ComboboxContent","ComboboxCommandInput","ComboboxCommandEmtpy","ComboboxCommandList","type","options","ComboboxCommandGroup","ComboboxCommandItem","EventTimestamp","occurred","date","formattedTime","formattedDate","TimelinePoint","event","isLast","resourceType","parseResourceType","iconId","RESOURCE_ICONS","Icon","formatRouteDate","year","month","day","EventNameWithPrefixes","eventId","eventName","label","formatEventLabel","eventDate","Link","getResourceRole","resource","getResourceId","getResourceName","EventRelatedResources","related","tags","resources","displayText","typeLabel","RESOURCE_TYPE_LABELS","EventResourceLink","tag","tagId","tagName","Badge","EventTimelineItem","isOpen","setIsOpen","Collapsible","Card","CardHeader","EventResourceDisplay","CollapsibleTrigger","Button","ChevronDown","CollapsibleContent","CardContent","JsonView","EventsTimeline","events","index","MAX_EVENT_TYPES_DISPLAYED","EventsTypeFilter","filter","selectedEventTypes","onEventTypesChange","eventCounts","useQuery","buildEventsCountQuery","eventTypeOptions","prefixSet","eventCount","prefixes","getEventPrefixes","prefix","handleSelectEventType","eventType","handleClearAll","renderSelectedEventTypes","visible","extraCount","Typography","Checkbox","PAGE_SIZE","useEventsPagination","currentPage","setCurrentPage","tokenVault","previousFilterRef","useEffect","currentFilterString","firstPageQuery","buildFilterEventsQuery","currentPageToken","nextPageQuery","buildEventsNextPageQuery","total","totalPages","isLoadingNextPage","page","EventsPage","onSearchChange","dateRange","getDateRangeFromSearch","eventsFilter","buildEventsFilterFromSearch","countFilter","buildEventsCountFilterFromSearch","countFilterForTypeDropdown","goToNextPage","goToPreviousPage","historyData","buildEventsHistoryQuery","handleResourceIdsChange","resourceIds","handleEventTypesChange","eventPrefixes","handleDateRangeChange","isChartSticky","setIsChartSticky","handleScroll","Breadcrumb","BreadcrumbList","BreadcrumbItem","Label","Skeleton","RichDateRangeSelector","EmptyState","EmptyStateIcon","EmptyStateTitle","EmptyStateDescription","Fragment","Pagination","PaginationContent","PaginationItem","PaginationPreviousButton","PaginationNextButton","EventsPageSkeleton","RouteComponent","Route","useSearch","navigate","useNavigate","handleSearchChange","updates","to","prev","replace"],"mappings":"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"}